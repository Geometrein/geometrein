---
author: "Tigran Khachatryan"
date: 2021-05-17
linktitle: Helsinki City Bikes Network Analysis
menu:
  main:
    parent: tutorials
#next: /path/to/previous/post
#prev: /path/to/next/post
title: Helsinki City Bikes Network Analysis
weight: 10
draft: false
tags: ["helsinki", "city bikes", "network analysis", "python"]
categories: ["Spatial Data Science", "Python"]
---

## Introduction

For the past decades, transportation systems are commonly analyzed as networks.
This abstraction allows to reduce the amount of information available and focus primarily on the internal structure of the underlying systems.

This idea is certainly not novel in [mathematics](https://en.wikipedia.org/wiki/Seven_Bridges_of_K%C3%B6nigsberg) or urban planning. However, the recent advances in computational technologies and GIS frameworks enabled new pragmatic applications of graph-theoretical ideas in the field of geographic mobility.

>Within the context of transportation, the term network refers to the framework of routes within a system of locations, identified as nodes.
A route is a single link between two nodes that are part of a larger network that can refer to tangible routes such as roads and rails, or less tangible routes such as air and sea corridors.
sad

![helsinki_bike_network](../../images/helsinki_city_bikes/graph_theory.png)


![helsinki_bike_network](../../images/helsinki_city_bikes/helsinki_bike_network_black_and_white.png)

Transportation networks normally denote either permanent physical tracks such as roads and railroads or scheduled services.
Unlike collective transportation(scheduled buses and trains), individual transportation (walking, bike-sharing) occurs on-demand and is more spatially flexible.
Thanks to this, systems of shared mobility have a huge potential for self-organization. It is crucial to highlight that edges of the city bike network are not predetermined, they are generated by the users.
Thus, the structure of the network emerges from the flow of people through the city.
Reoccurring trips made by the residents gradually formulate usage patterns and create the structure of the bike-sharing network. This information, in turn, can be used in a feedback loop for the evolution of the network.
Rising or decreasing bike demand can provide insights into wider sociological, economical and geographic factors in certain areas.
The graph below illustrates bike usage in different areas of Helsinki during 2020.

![helsinki_bike_network](../../images/helsinki_city_bikes/helsinki_bubble_map.png)

As expected the central Helsinki is the most active region in terms of geographic mobility.
However, as pointed out in the first part of this article, the geographic centre of Helsinki and the centre of Helsinki bike network are not the same.

## Network Centrality Measures

Complex networks by definition are highly heterogeneous structures.
This often results in some parts of the network being more information-rich than others.
For example, in social networks, some individuals might have a large number of connections and can spread information faster than others.
Hence, within the context of social network analysis, the nodes that represent them are considered more important(central).
Within the context of transportation networks, an urban region where the influx of people is higher than in the other areas can be considered central.
However, the centrality of a given network may change over time as a result of the growth and evolution of the underlying system.
Thus, the definition of centrality is not absolute but rather depends on the specific context and the purpose of the abstraction.
Taking this relativity into account, several centrality measures have been proposed that focus on different types of relationships between the nodes.

### Degree Centrality

{{</* katex display=true >}}
C_D(v) = \deg(v) = |\{u \in V : (v, u) \in E\}|
{{< /katex */>}}

Degree centrality is the most simple centrality measure to understand and compute.
“Degree” of a node refers to the number of nodes that a given node is connected to.
Within the context of city bikes, this refers to the number of bike stations that users have travelled to from the target station.
As we can see in the graph below stations located in central Helsinki have a higher number of connections.
Closer to the periphery of the network the degree of the nodes gradually decreases.

![helsinki_bike_network](../../images/helsinki_city_bikes/degree_centrality.png)

The average degree of a node in the Helsinki city bike network is 162.
This means that a bike station on average is connected to 162 different stations.
The stations with the highest centrality degree are:

```
Haukilahdenkatu:    312 connections
Paciuksenkaari:     272 connections
Huopalahdentie:     267 connections 
Laajalahden aukio:  262 connections
Munkkiniemen aukio: 262 connections
Töölöntulli:        260 connections
Tilkanvierto:       259 connections
Paciuksenkatu:      258 connections
Pasilan asema:      258 connections 
Esterinportti:      256 connections 
```
The fact that Haukilahdenkatu station is at the top of this list suggests that a large number of citizens from different districts make regular trips to and from this station.

![helsinki_bike_network](../../images/helsinki_city_bikes/haukilahdenkatu_station.png)

This could potentially mean that this station is either next to a large transportation hub or an important point of interest.
Quick google search will reveal that it's located across the street from a large educational institution and a work rehabilitation centre.
This explains both the regularity of the trips and the inflow of people from different suburban areas.

### Betweenness Centrality

{{</* katex display=true >}}
C_B(v) = \sum_{s \ne v \ne t} \frac{\sigma_{st}(v)}{\sigma_{st}}
{{< /katex */>}}

The betweenness centrality captures how much a given node is “in-between” others.
This measure calculates the shortest paths between all the nodes of the network and assigns each node a measure based on the number of shortest paths going through the target node.
The graph below illustrates the city bike stations by betweenness centrality.

![helsinki_bike_network](../../images/helsinki_city_bikes/betweenness_centrality.png)

The node with the highest betweenness centrality represents the Lehtisaarentie station.
This is a well-saturated example of geographic constraints affecting the structure of spatial networks.
The station is located on the Lehtisaari island that links the Aalto University campus to Munkkiniemi and Helsinki.
Due to the specificity of the Helsinki archipelago, traffic flows from one municipality to another are mostly channelled through island-bridge systems that lie in between.
This makes both Lehtisaari and Lautasarri islands crucial traffic nodes connecting the municipality of Espoo to Helsinki.


### Closeness Centrality
Closeness centrality is a way of detecting nodes that are able to distribute flows efficiently through the network.
The closeness centrality is calculated as the normalized average of all of its geodesic distances.
Within the context of the city bikes, a node with high closeness centrality will indicate stations that can potentially act as versatile intermediary stations within the network.

![helsinki_bike_network](../../images/helsinki_city_bikes/closeness_centrality.png)

As illustrated before a large amount of station is directly connected to Haukilahdenkatu station. This leads to Haukilahdenkatu station having the highest closeness centrality within the network.
Other nodes with high closeness centrality are located in the areas of Töölo and Pasila. Closeness centrality might be interesting metrics for network optimization, especially for larger networks.
In larger bike-sharing networks users might be motivated to make stops at the intermediary bike stations to avoid extra charges.
However, as we have seen in the previous part of this article long trips are not common in Helsinki.

### Eigenvector Centrality & PageRank

{{</* katex display=true >}}
C_E(v) = \frac{1}{\lambda} \sum_{u \in V} A_{vu} \, C_E(u)
{{< /katex */>}}

{{</* katex display=true >}}
PR(v) = \frac{1 - d}{N} + d \sum_{u \in \text{In}(v)} \frac{PR(u)}{\deg^{+}(u)}
{{< /katex */>}}

Eigenvector centrality measures a node’s importance within the network while giving consideration to the importance of its neighbours.
Connections to high-scoring eigenvector centrality nodes contribute more to the score than equal connections to low-scoring nodes.
In other words, a node with a large number of connections may have a low Eigenvector score if all of its connections are with low-score nodes.
A popular variation of eigenvector centrality is Google’s PageRank. In essence, PageRank is a variation of normalized eigenvector centrality combined with random jumps.
Thus, it is not surprising that Pagerank yields result comparable to Eigenvector(graphs below).
With this method, stations like the Central Railway Station, Pasila, Lehtisaarentie and Haukilahdenkatu appear as central nodes within the network.

![helsinki_bike_network](../../images/helsinki_city_bikes/eigen_vector.png)


The application of eigenvector and PageRank in an urban context is a subject of ongoing debate.
It has been suggested that these metrics applied in an urban context often lead to misleading results since they ignore a multitude of urban qualities that might contribute to the importance of the node within the city.
While these limitations might be a problem in collective transportation systems where the routes of the services are predetermined, this is certainly not the case with individual transportation.
As mentioned before, the structure of individual transportation networks is generated by the users therefore it already has some information about the urban qualities embedded in it.
The fact that users have a choice and choose to take one path instead of the other creates a trivial voting mechanism that rates different areas of the city.
Thus, in this kind of networks, the study of the structure of the network is also a study of user behaviour and their preferable urban qualities.
Additionally, Eigenvector centrality in individual transportation networks allows highlighting not only important singular nodes but also geographically important areas within the city.
This is possible because it acknowledges not only the importance of individual station but also the importance of stations adjacent to them.
Eigenvector centrality illustrates that importance in the city bike stations(nodes) is derived no so much from their inherent attributes(location, station size) but rather from their relationships with other nodes within the network.
Central stations together with nodes adjacent to them form small enclaves of activity. The identification of this kind of groupings of nodes within the context of complex networks is commonly referred to as community detection.


## Community Detection
Communities in networks refer to groups of nodes that are densely connected internally.
Community detection is often a crucial process for understanding the structure of complex networks.
In the case of the city bike network, community detection can help to better understand bike usage patterns and determine adequate pricing models.
There is a number of algorithms available for community detection.

### Combo Method
The majority of exiting community detection strategies iteratively perform one of the following operations: merging two small communities (agglomerative), splitting a large community into two(divisive), moving nodes between two distinct communities.
The Combo algorithm developed at MIT sensible city lab compounds all three strategies into a sequence. After creating an initial single community, for each source community, the best possible redistribution of all source nodes is calculated then the best grouping is applied.
These steps are iteratively repeated until the given fitness criteria are achieved. The graph below illustrates the Combo method applied to the Helsinki city bike network.

![helsinki_bike_network](../../images/helsinki_city_bikes/combo_method.png)

This grouping reveals two distinct communities that are separated approximately in line with the exiting municipality divisions.
This is perhaps not extremely informative since this division could have been assumed merely by looking at the map.
Based on the first part of this article, intuitive understanding suggests that bikes are more likely to be used inside the municipalities on shorter distances.
Therefore, if other communities exist they should be found on a more local scale.

### Louvain Method
Since the previous community detection method did not yield insightful results, we can apply a different method that specifically focuses on the modularity of the network.
The Louvain community detection is a good candidate due to its beautiful simplicity and computational efficiency.
It efficiently handles the NP-complete computability problem of maximum cuts in Graphs that is present in all community detection tasks. Applying the Louvain method to the Helsinki city bike network reveals four distinct communities.

![helsinki_bike_network](../../images/helsinki_city_bikes/louvain_method.png)

This means that bike usage inside these four communities is higher than the bike usage between these communities. Nodes with high betweenness centrality are usually the places where the communities might be divided into modules. If we return to our betweenness centrality graph this relationship will become even more evident. Boundaries of the communities pass roughly through the nodes with high betweenness centrality. Also, this division doesn’t come as a surprise taking into account the geographic character of the Helsinki archipelago. Landmasses and their divisions by large bodies of water significantly affect community formation. It is important to highlight that all transportation networks are spatial networks and their structure and evolution are closely intertwined with physical constraints. An interesting discovery is that the Leppavara area, despite being part of Espoo municipality, is more densely connected to Munkiniemi and Pitäjänmaki than to Otniemi or Tapiola areas. A similar tendency can be seen in some stations around Sörnäinen where stations are more densely connected to the Herttoniemi area.

### Fluid Communities Method
The Fluid Communities algorithm is a community detection algorithm based on the idea of introducing a number of fluids within a non-homogeneous environment, where fluids will expand and push each other influenced by the topology of the environment until a stable state is reached. The algorithm does the following. First, it defines each of the starting communities in a random node of the graph. Then the algorithm iterates over all nodes in a random order, updating the community of each node based on its own community and the communities of its neighbours. This process is performed iteratively until convergence.

![helsinki_bike_network](../../images/helsinki_city_bikes/fluid_method.png)

We can see that the Fluid community detection method confirms the communities identified with the Louvain method and identifies one additional community.

- Eastern Espoo(Magenta Community) is a distinct community shaped by geographic constraints and extending along the metro line towards the West.
- Leppävaara, Pitäjanmaki, Munkiniemi, and Etelä Haaga (Green Community) form another cycling community despite the municipality divisions separating the districts.
- The areas of Vallila, Kapyla and Oulunkylä form another group(Pink Community) separated from the Green community by Central Park. This community is stretched along the railroad in northern Helsinki.
- The southern part of Helsinki (Blue Community) includes the geographic centre of Helsinki and major stations such as Kammpi, central railway station and extends towards the southern shoreline.
- Meanwhile, Herttoniemi is at the centre of another enclave (Yellow Community) that extend from Sornainen to Vuosaari along the metro line.

## Conclusion
In this part of the article, the Helsinki city bike network was briefly analyzed as a complex network. Multiple centrality measures were applied to the network and important centres were identified. Tree community detection algorithms revealed different possible groupings of the nodes within the network. The next part of the article will take a look at how machine learning methods can be applied to further enhance understanding of relationships within the network.
